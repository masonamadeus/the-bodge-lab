<!DOCTYPE html>
<html lang="en">
    <head>
        
        <script>
            (function () {
                const STORAGE_KEY = 'bodge-id-v1';
                const SIZE = 5;
                // 1. Try to load existing identity
                let identity = null;
                try {
                    identity = JSON.parse(localStorage.getItem(STORAGE_KEY));
                } catch (e) {}
                // 2. If no identity, GENESIS MODE (Random Generation)
                if (! identity) {
                    const hue = Math.floor(Math.random() * 360);
                    const grid = new Array(SIZE * SIZE).fill(null);
                    // Generate Mirrored Pattern
                    for (let x = 0; x < Math.ceil(SIZE / 2); x++) {
                        for (let y = 0; y < SIZE; y++) {
                            if (Math.random() > 0.5) {
                                const alpha = (Math.random() * 0.6 + 0.4).toFixed(2);
                                // We store: { o: opacity, c: customColor (optional) }
                                const pixel = {
                                    o: alpha
                                };
                                // Set Left
                                grid[y * SIZE + x] = pixel;
                                // Set Mirror
                                if (x < Math.floor(SIZE / 2)) {
                                    grid[y * SIZE + (SIZE - 1 - x)] = pixel;
                                }
                            }
                        }
                    }
                    identity = {
                        hue,
                        grid
                    };
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(identity));
                }
                // 3. Render SVG Define Theme Colors based on the stored Hue
                const cLight = `hsl(${
                    identity.hue
                }, 80%, 40%)`;
                const cDark = `hsl(${
                    identity.hue
                }, 80%, 70%)`;
                let rects = '';
                identity.grid.forEach((pixel, i) => {
                    if (!pixel) 
                        return;
                    
                    const x = i % SIZE;
                    const y = Math.floor(i / SIZE);
                    // If pixel has a custom color, use it. Otherwise use CSS var. We use a CSS class 'themable' to let the style block
                    // handle standard pixels
                    const fillAttr = pixel.c
                        ? `fill="${
                        pixel.c
                    }"` : `class="themable"`;
                    rects += `<rect x="${x}" y="${y}" width="1" height="1" opacity="${
                        pixel.o
                    }" ${fillAttr} />`;
                });
                const svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${SIZE} ${SIZE}" shape-rendering="crispEdges">
            <style>
                .themable { fill: ${cLight}; }
                @media (prefers-color-scheme: dark) {
                    .themable { fill: ${cDark}; } 
                }
                /* Custom text color checks */
                text { fill: black; font-weight: 900; pointer-events: none; }
                @media (prefers-color-scheme: dark) { text { fill: white; } }
            </style>
            ${rects}
            <text x="2.5" y="3.5" text-anchor="middle" font-family="monospace" font-size="3px"></text>
            </svg>`;
                const link = document.createElement('link');
                link.rel = 'icon';
                link.id = 'dynamic-favicon'; // ID for easier updates later
                link.href = 'data:image/svg+xml,' + encodeURIComponent(svg);
                document.head.appendChild(link);
                // Expose for the editor to use
                window.BodgeIdentity = {
                    data: identity,
                    save: (newData) => {
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(newData));
                    }
                };
            })();
        </script>
        <link rel="stylesheet" href="/css/main.css">
        <script src="/js/theme.js"></script>
        <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <meta charset="UTF-8">
        <title>systemrestore.js</title>
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="generator" content="Eleventy v3.1.2">
        <meta name="description" content="A curious folder on the internet. Home of Mason Amadeus">
        <link
        rel="canonical" href="https://bodgelab.com/%7B%7B%20media.url%20|%20safe%20%7D%7D.html"> 
        <meta property="og:site_name" content="The Bodge Lab">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://bodgelab.com/%7B%7B%20media.url%20|%20safe%20%7D%7D.html">
        <meta property="og:title" content="systemrestore.js">
        <meta
        property="og:description" content="A curious folder on the internet. Home of Mason Amadeus"> 
        <meta property="og:image" content="https://bodgelab.com/.config/ogimg.jpg">
        <meta
        name="twitter:image" content="https://bodgelab.com/.config/ogimg.jpg">
        
        
            
            <meta name="twitter:card" content="summary_large_image">
        
    </head>
    <body>
        <svg id="paperfilter">
            <defs>
                <filter id="paperlike" x="-20%" y="-20%" width="140%" height="140%" type="fractalNoise">
                    <feTurbulence basefrequency="0.0005" numoctaves="1" result="noise"/>
                    <feDisplacementMap in="SourceGraphic" in2="noise" scale="1" xchannelselector="R" ychannelselector="R"></filter>
                </defs>
            </svg>
            <header class="sticky">
                <nav class="nav-container">
                    <div class="breadcrumb-nav">
                        <div class="breadcrumb-mover">
                            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle Theme">
                                <svg
                                    viewbox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    class="theme-icon">
                                    <path id="sun-icon" d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                                    <g id="moon-icon">
                                        <path d="M12 2a7 7 0 0 0-7 7c0 2.32 1.04 4.39 2.66 5.82a2 2 0 0 1 .68 1.48V19a2 2 0 0 0 2 2h3.32a2 2 0 0 0 2-2v-2.7a2 2 0 0 1
                                            .68-1.48C17.96 13.39 19 11.32 19 9a7 7 0 0 0-7-7Z"></path>
                                        <path d="M9 21h6"></path>
                                        <path d="M9 17h6"></path>
                                    </g>
                                </svg>
                            </button>
                            <span class="separator">\\</span>
                            <a href="/" class="breadcrumb" title="Home Directory">BodgeLab</a>
                            
                            
                            
                                
                            
                                
                                    
                                    <span class="separator">\</span>
                                    
                                        <a href="/Stealware/" class="breadcrumb">Stealware</a>
                                    
                                
                            
                                
                                    
                                    <span class="separator">\</span>
                                    
                                        <a href="/Stealware/PodCube API/" class="breadcrumb">PodCube API</a>
                                    
                                
                            
                                
                                    
                                    <span class="separator">\</span>
                                    
                                        <a href="/Stealware/PodCube API/trash/" class="breadcrumb">trash</a>
                                    
                                
                            
                                
                                    
                                    <span class="separator">\</span>
                                    
                                        <span class="current">systemrestore.js</span>
                                    
                                
                            
                        </div>
                    </div>
                    <div
                        class="page-nav">
                        
                        
                            <div>
                                <a href="/Stealware/PodCube API/trash/" class="nav-link up">⇱ Go Up</a>
                            </div>
                        
                        
                        
                            <div class="page-meta-date">
                                <i>
                                    <em>Modified: February 28, 2026</em>
                                </i>
                            </div>
                        
                    </div>
                </nav>
            </header>
            
                <main class="main-content">
                    
  <h2>systemrestore.js</h2>
  
  
  
    <div class="media-embed-wrapper text-embed">
                      <pre class="language-js"><code class="language-js">// =============================================================================
// SYSTEM RESTORE v6.0 - Definitive Edition
// =============================================================================

const GRID_SIZE = 8;
const UI_HEIGHT = 48;

// Terrain IDs
const T_NULL = 0;
const T_DATA = 1;   // Destructible (Dark Blue)
const T_HARD = 2;   // Indestructible (White)
const T_CODE = 3;   // Player Built (Cyan)
const T_FIRE = 5;   // Hazard (Orange)
const T_CACHE = 6;  // Bonus (Gold)

// Palette
const PALETTE = {
    BG:     &#039;#0a1929&#039;,
    DATA:   &#039;#1e3a5f&#039;,
    HARD:   &#039;#f0f4f8&#039;,
    FIRE:   &#039;#ff5500&#039;,
    CODE:   &#039;#00e5ff&#039;,
    BIT:    &#039;#ffffff&#039;,
    GOLD:   &#039;#ffd700&#039;,
    UI_OFF: &#039;#172a45&#039;,
    UI_TXT: &#039;#94a3b8&#039;,
    UI_DIS: &#039;#0f172a&#039;
};

// Costs for Roles
const COSTS = {
    &#039;WALKER&#039;: 0,   &#039;BASHER&#039;: 20, &#039;MINER&#039;: 20,
    &#039;BUILDER&#039;: 30, &#039;FLOATER&#039;: 15, &#039;BLOCKER&#039;: 10,
    &#039;BOMBER&#039;: 5,   &#039;NUKE&#039;: 0,    &#039;PAUSE&#039;: 0
};

const MAX_FALL_DIST = 70;
const DIG_INTERVAL = 0.12; 

// ─── VISUAL EFFECTS ──────────────────────────────────────────────────────────

class GlitchFragment extends Entity {
    constructor(x, y, color) {
        super(x, y);
        this.vx = PC.rand(-90, 90);
        this.vy = PC.rand(-90, 90);
        this.color = color;
        this.life = 0.5;
        this.z = 50; 
    }
    update(dt) {
        this.x += this.vx * dt;
        this.y += this.vy * dt;
        this.life -= dt;
        if (this.life &lt;= 0) this.destroy();
    }
    draw(gfx) {
        gfx.rect(this.x, this.y, 2, 2, this.color);
    }
}

// ─── DATA PACKET (The Lemming) ───────────────────────────────────────────────

class DataPacket extends Physics.Actor {
    constructor(x, y) {
        super(x, y, GRID_SIZE - 2, GRID_SIZE - 1);
        this.dir = 1; 
        this.speed = 22;
        this.role = &#039;WALKER&#039;;
        this.timer = 0;
        this.actionQuota = 0;
        this.pendingPurge = false;
        this.fallStartY = y;
        this.wasGrounded = false;
        this.bitLabel = Math.random() &gt; 0.5 ? &#039;1&#039; : &#039;0&#039;;
        this.flickerTimer = 0;
    }

    // Assign Role (Handles Logic &amp; Economy)
    assignRole(newRole, game) {
        // Free Action: Flip Direction
        if (this.role === newRole) {
            this.flipDirection();
            return true;
        }

        // Paid Action: Buy Tool
        const cost = COSTS[newRole] || 0;
        if (game.cycles &lt; cost) return false; // Too expensive

        game.spendCycles(cost);
        this.role = newRole;
        this.timer = 0;
        this.actionQuota = 0;

        // Role Stats
        if (newRole === &#039;BUILDER&#039;) this.actionQuota = 5;
        if (newRole === &#039;BASHER&#039;)  this.actionQuota = 15;
        if (newRole === &#039;MINER&#039;)   this.actionQuota = 15;
        if (newRole === &#039;BOMBER&#039;)  this.timer = 0.2; 

        // Stop moving if it&#039;s a stationary role
        this.z = (newRole !== &#039;WALKER&#039;) ? 10 : 0;
        if ([&#039;BLOCKER&#039;, &#039;BUILDER&#039;, &#039;BOMBER&#039;, &#039;MINER&#039;].includes(newRole)) {
            this.vx = 0;
            this.remainderX = 0; 
        }
        return true;
    }

    flipDirection() {
        this.dir *= -1;
        if (this.role === &#039;WALKER&#039;) this.vx = this.dir * this.speed; 
    }

    update(dt, input, game) {
        const world = game.world;
        
        // Visual Flicker
        this.flickerTimer += dt;
        if (this.flickerTimer &gt; 0.15) {
            this.bitLabel = this.bitLabel === &#039;1&#039; ? &#039;0&#039; : &#039;1&#039;;
            this.flickerTimer = 0;
        }

        // 1. Environmental Triggers
        const gridX = world.toGrid(this.x + this.w / 2);
        const gridY = world.toGrid(this.y + this.h + 1);
        const tileUnder = world.get(gridX, gridY);

        if (tileUnder === T_FIRE) { this.terminate(game, false); return; }
        if (tileUnder === T_CACHE) {
            world.set(gridX, gridY, T_NULL);
            game.secureBonus();
        }

        // 2. Entity Collision (Blockers)
        const neighbors = game.collideAll(this, DataPacket);
        for (const other of neighbors) {
            if (other.role === &#039;BLOCKER&#039;) {
                if ((this.x &lt; other.x &amp;&amp; this.dir &gt; 0) || (this.x &gt; other.x &amp;&amp; this.dir &lt; 0)) this.flipDirection();
            }
        }

        if (this.pendingPurge &amp;&amp; this.role !== &#039;BOMBER&#039;) this.assignRole(&#039;BOMBER&#039;, game);

        // 3. Role Logic
        if (this.role === &#039;WALKER&#039; || this.role === &#039;FLOATER&#039;) {
            this.vx = this.dir * this.speed;
        } else if (this.role === &#039;BASHER&#039;) {
            this.vx = this.dir * (this.speed * 0.6);
            const wallX = world.toGrid(this.dir &gt; 0 ? this.x + this.w + 1 : this.x - 1);
            const wallY = world.toGrid(this.y + 4);
            const tFront = world.get(wallX, wallY);
            // Bash through Data, Cache, or Code
            if (tFront === T_DATA || tFront === T_CACHE || tFront === T_CODE) {
                 world.set(wallX, wallY, T_NULL);
                 game.spawnEffects(wallX*GRID_SIZE, wallY*GRID_SIZE, PALETTE.DATA);
                 this.actionQuota -= (dt * 2); 
            } else if (tFront === T_HARD) { 
                this.flipDirection(); this.role = &#039;WALKER&#039;; 
            }
            if (this.actionQuota &lt;= 0) this.role = &#039;WALKER&#039;;
        } else if (this.role === &#039;MINER&#039;) {
            this.vx = 0; 
            this.timer += dt;
            if (this.timer &gt; DIG_INTERVAL) {
                this.timer = 0;
                const gx = world.toGrid(this.x + this.w / 2);
                const gy = world.toGrid(this.y + this.h + 1);
                const tBelow = world.get(gx, gy);
                if (tBelow === T_DATA || tBelow === T_CACHE || tBelow === T_CODE) {
                    world.set(gx, gy, T_NULL);
                    game.spawnEffects(gx*GRID_SIZE, gy*GRID_SIZE, PALETTE.DATA);
                    this.actionQuota--;
                    if (this.actionQuota &lt;= 0) this.role = &#039;WALKER&#039;;
                } else { this.role = &#039;WALKER&#039;; }
            }
        } else if (this.role === &#039;BUILDER&#039;) {
            this.vx = 0;
            this.timer -= dt;
            if (this.timer &lt;= 0) {
                if (this.actionQuota &gt; 0) {
                    if (this.executeBuild(world)) {
                        this.actionQuota--;
                        this.timer = 0.5; 
                    } else { this.role = &#039;WALKER&#039;; }
                } else { this.role = &#039;WALKER&#039;; }
            }
        } else if (this.role === &#039;BOMBER&#039;) {
            this.vx = 0;
            this.timer -= dt;
            if (this.timer &lt;= 0) { this.executePurge(world, game); this.destroy(); return; }
        }

        const intendedDir = this.dir;
        const wasMoving = (this.role === &#039;WALKER&#039; || this.role === &#039;BASHER&#039;);
        this.updatePhysics(dt, world, 600);

        // 4. Wall Interaction
        if (wasMoving &amp;&amp; this.vx === 0) {
            const sideX = world.toGrid(intendedDir &gt; 0 ? this.x + this.w + 1 : this.x - 1);
            const sideY = world.toGrid(this.y + this.h / 2);
            // Die on firewall impact
            if (world.get(sideX, sideY) === T_FIRE) { this.terminate(game, false); return; }

            // Auto-step up 1 block
            if (this.grounded &amp;&amp; this.checkStepUp(world, intendedDir)) {
                this.y -= GRID_SIZE; this.x += intendedDir * 2; this.vx = intendedDir * this.speed;
            } else { 
                // Bounce
                this.dir = -intendedDir; this.vx = this.dir * (this.role === &#039;WALKER&#039; ? this.speed : this.speed * 0.5); 
            }
        }

        // 5. Fall Damage
        if (!this.wasGrounded &amp;&amp; this.grounded) {
            if (this.y - this.fallStartY &gt; MAX_FALL_DIST &amp;&amp; this.role !== &#039;FLOATER&#039;) { this.terminate(game, true); return; }
        }
        if (this.grounded) this.fallStartY = this.y;
        this.wasGrounded = this.grounded;
    }

    executeBuild(world) {
        const gx = world.toGrid(this.x + this.w / 2);
        const gy = world.toGrid(this.y + this.h - 1);
        // Smart Build: Fill gap below first (Safety platform)
        if (world.get(gx, gy + 1) === T_NULL) { world.set(gx, gy + 1, T_CODE); return true; }
        
        const tx = gx + this.dir;
        if (world.get(tx, gy) !== T_NULL || world.get(tx, gy - 1) !== T_NULL) return false;
        world.set(tx, gy, T_CODE);
        this.x = (tx * GRID_SIZE); this.y = (gy * GRID_SIZE) - this.h - 0.1;
        this.vx = 0; this.remainderX = 0;
        return true;
    }

    checkStepUp(world, d) {
        const gx = world.toGrid(d &gt; 0 ? this.x + this.w + 1 : this.x - 1);
        const gy = world.toGrid(this.y + this.h - 1);
        const spaceAboveWall = world.get(gx, gy - 1) === T_NULL;
        const spaceAboveSelf = world.get(world.toGrid(this.x + this.w / 2), gy - 1) === T_NULL;
        return world.get(gx, gy) &gt; 0 &amp;&amp; spaceAboveWall &amp;&amp; spaceAboveSelf;
    }

    executePurge(world, game) {
        const cx = world.toGrid(this.x + this.w / 2);
        const cy = world.toGrid(this.y + this.h / 2);
        // Explosion radius
        for (let y = cy - 2; y &lt;= cy + 2; y++) {
            for (let x = cx - 2; x &lt;= cx + 2; x++) {
                if (x &lt;= 0 || x &gt;= world.cols - 1 || y &lt;= 0 || y &gt;= world.rows - 1) continue;
                if (world.get(x, y) !== T_HARD) world.set(x, y, T_NULL);
            }
        }
        game.spawnEffects(this.x, this.y, PALETTE.FIRE);
    }

    terminate(game, fx) { if (fx) game.spawnEffects(this.x, this.y, PALETTE.BIT); this.destroy(); }

    draw(gfx) {
        const colors = { &#039;WALKER&#039;: PALETTE.BIT, &#039;FLOATER&#039;: PALETTE.CODE, &#039;BLOCKER&#039;: PALETTE.FIRE, &#039;BUILDER&#039;: PALETTE.HARD, &#039;BASHER&#039;: &#039;#ff00ff&#039;, &#039;MINER&#039;: &#039;#00ff00&#039; };
        let c = colors[this.role] || PALETTE.BIT;
        if (this.role === &#039;BOMBER&#039;) c = (this.timer * 5) % 2 &gt; 1 ? PALETTE.BG : PALETTE.FIRE;
        gfx.rect(this.x, this.y, this.w, this.h, c);
        const eyeX = this.dir &gt; 0 ? this.x + 4 : this.x;
        gfx.rect(eyeX, this.y+1, 2, 2, PALETTE.BG);
        gfx.text(this.bitLabel, this.x + 1, this.y - 2, {size: 6, color: PALETTE.CODE});
    }
}

class UploadPort extends Entity {
    constructor(x, y) { super(x, y); this.w=24; this.h=24; }
    update(dt, input, game) {
        const arrivals = game.collideAll(this, DataPacket);
        arrivals.forEach(p =&gt; { p.destroy(); game.securePacket(); game.spawnEffects(this.x+10, this.y+10, PALETTE.GOLD); });
    }
    draw(gfx) {
        const glow = Math.abs(Math.sin(Date.now()/200)) * 0.5;
        gfx.rect(this.x, this.y, this.w, this.h, `rgba(79, 195, 247, ${0.2 + glow})`);
        gfx.rect(this.x+6, this.y+6, 8, 8, PALETTE.BIT);
        gfx.text(&#039;UPLOAD&#039;, this.x-2, this.y-5, {size: 6, color: PALETTE.BIT});
    }
}

// ─── GAME CONTROLLER ─────────────────────────────────────────────────────────

class SystemRestoreGame extends Game {
    static meta = {
        id: &quot;system-restore&quot;,
        title: &quot;System Restore v6.0&quot;,
        desc: &quot;Definitive Edition. Tactical Data Routing.&quot;,
        instructions: &quot;[1-9] Buy Tool | [CLICK IN] Inject | [SPACE] Pause &amp; Plan&quot;
    };

    static ICONS = {
        WALKER: &#039;&lt;path d=&quot;M13 5l7 7-7 7M5 5l7 7-7 7&quot;/&gt;&#039;,
        BASHER: &#039;&lt;path d=&quot;M10 12h11M10 12l4-4m-4 4l4 4M3 6v12&quot;/&gt;&#039;,
        MINER: &#039;&lt;path d=&quot;M19 5L5 19m0 0h9m-9 0v-9&quot;/&gt;&#039;,
        BUILDER: &#039;&lt;path d=&quot;M2 20h4v-4h4v-4h4v-4h4v-4h4v-4h4v-4h4v-4h4v-4h4&quot;/&gt;&#039;,
        FLOATER: &#039;&lt;path d=&quot;M12 22V10m0 0l-5 5m5-5l5 5M4 8h16c0-4-4-6-8-6S4 4 4 8z&quot;/&gt;&#039;,
        BLOCKER: &#039;&lt;rect x=&quot;4&quot; y=&quot;4&quot; width=&quot;16&quot; height=&quot;16&quot; rx=&quot;2&quot;/&gt;&lt;path d=&quot;M8 12h8&quot;/&gt;&#039;,
        BOMBER: &#039;&lt;circle cx=&quot;12&quot; cy=&quot;12&quot; r=&quot;3&quot;/&gt;&lt;path d=&quot;M12 2v3m0 14v3M2 12h3m14 0h3m-3-7l-2 2m-10 10l-2 2m0-14l2 2m10 10l2 2&quot;/&gt;&#039;,
        NUKE: &#039;&lt;path d=&quot;M21 4H3m2 0l1 16a2 2 0 002 2h10a2 2 0 002-2l1-16M9 9v8m6-8v8M9 4V2h6v2&quot;/&gt;&#039;,
        PAUSE: &#039;&lt;rect x=&quot;6&quot; y=&quot;4&quot; width=&quot;4&quot; height=&quot;16&quot;/&gt;&lt;rect x=&quot;14&quot; y=&quot;4&quot; width=&quot;4&quot; height=&quot;16&quot;/&gt;&#039;
    };

    static getIconUrl(name, color = &#039;white&#039;) {
        const svg = `&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; viewBox=&quot;0 0 24 24&quot; fill=&quot;none&quot; stroke=&quot;${color}&quot; stroke-width=&quot;2.5&quot; stroke-linecap=&quot;round&quot; stroke-linejoin=&quot;round&quot;&gt;${SystemRestoreGame.ICONS[name]}&lt;/svg&gt;`;
        return `url(&quot;data:image/svg+xml;utf8,${encodeURIComponent(svg)}&quot;)`;
    }

    onInit() {
        this.score = 0; this.selectedTool = &#039;WALKER&#039;; this.isPaused = false;
        this.cycles = 100;
        this.glitchTimer = 0;
        this.level = this.api.getData(&#039;level&#039;) || 1;
        const carryOver = this.api.getData(&#039;bonus_carry&#039;) || 0;
        this.packetQueue = 12 + Math.floor(this.level * 1.5) + carryOver;
        this.cycles += (this.level * 25);
        this.api.saveData(&#039;bonus_carry&#039;, 0);

        const gridH = this.api.H - UI_HEIGHT;
        this.world = new Physics.World(Math.ceil(this.api.W / GRID_SIZE), Math.ceil(gridH / GRID_SIZE), GRID_SIZE);
        
        this.setupLevel();
        this.buildUI();
        
        this.keyHandler = (e) =&gt; {
            const tools = [&#039;WALKER&#039;,&#039;BASHER&#039;,&#039;MINER&#039;,&#039;BUILDER&#039;,&#039;FLOATER&#039;,&#039;BLOCKER&#039;,&#039;BOMBER&#039;,&#039;NUKE&#039;,&#039;PAUSE&#039;];
            if(e.key === &#039; &#039; || e.key === &#039;p&#039;) { this.selectTool(&#039;PAUSE&#039;); return; }
            const idx = parseInt(e.key) - 1;
            if (idx &gt;= 0 &amp;&amp; idx &lt; tools.length) this.selectTool(tools[idx]);
        };
        window.addEventListener(&#039;keydown&#039;, this.keyHandler);
    }

    onCleanup() { window.removeEventListener(&#039;keydown&#039;, this.keyHandler); }

    setupLevel() {
        const cols = this.world.cols; const rows = this.world.rows;
        this.spawnPos = { x: 40, y: 40 };
        this.add(new UploadPort((cols - 8) * GRID_SIZE, (rows - 10) * GRID_SIZE));

        // 1. Organic Terrain (Cellular Automata)
        const density = 0.52 + (Math.random() * 0.13);
        for (let i = 0; i &lt; this.world.data.length; i++) this.world.data[i] = Math.random() &lt; density ? T_NULL : T_DATA;

        // Smooth it out
        for (let iter = 0; iter &lt; 4; iter++) {
            const nextData = new Uint8Array(this.world.data);
            for (let y = 1; y &lt; rows - 1; y++) {
                for (let x = 1; x &lt; cols - 1; x++) {
                    let neighbors = 0;
                    for (let dy = -1; dy &lt;= 1; dy++) for (let dx = -1; dx &lt;= 1; dx++) if (this.world.get(x + dx, y + dy) !== T_NULL) neighbors++;
                    if (neighbors &gt; 4) nextData[y * cols + x] = T_DATA; else if (neighbors &lt; 4) nextData[y * cols + x] = T_NULL;
                }
            }
            this.world.data = nextData;
        }

        // 2. Corruption Clusters (Firewall Patches)
        const numClusters = 5 + (this.level); 
        for(let i=0; i&lt;numClusters; i++) {
            let cx = PC.randInt(10, cols-10);
            let cy = PC.randInt(10, rows-10);
            const size = PC.randInt(2, 5);
            for(let j=0; j&lt;size*3; j++) {
                cx += PC.randInt(-1, 1);
                cy += PC.randInt(-1, 1);
                if (cx &gt; 0 &amp;&amp; cx &lt; cols &amp;&amp; cy &gt; 0 &amp;&amp; cy &lt; rows) {
                    if (this.world.get(cx, cy) !== T_HARD) this.world.set(cx, cy, T_FIRE);
                }
            }
        }

        // 3. Bonus Caches (+Cycles)
        const numCaches = PC.randInt(2, 4);
        for(let i=0; i&lt;numCaches; i++) {
            let placed = false; let attempts = 0;
            while(!placed &amp;&amp; attempts &lt; 50) {
                const x = PC.randInt(5, cols-5); const y = PC.randInt(5, rows-5);
                if (this.world.get(x,y) === T_NULL &amp;&amp; this.world.get(x, y+1) !== T_NULL) {
                    this.world.set(x, y, T_CACHE); placed = true;
                }
                attempts++;
            }
        }

        // Borders &amp; Spawner Insurance
        for (let y = 0; y &lt; rows; y++) { this.world.set(0, y, T_HARD); this.world.set(cols - 1, y, T_HARD); }
        for (let x = 0; x &lt; cols; x++) { this.world.set(x, 0, T_HARD); this.world.set(x, rows - 1, T_FIRE); }

        const sgx = this.world.toGrid(this.spawnPos.x); 
        const sgy = this.world.toGrid(this.spawnPos.y);
        
        // Clear small shaft
        for(let y=sgy; y&lt;sgy+8; y++) {
            this.world.set(sgx, y, T_NULL); this.world.set(sgx-1, y, T_NULL);
        }
        // Force Platform exactly 4 blocks down (Safety)
        const platY = sgy + 4;
        this.world.set(sgx-1, platY, T_HARD); 
        this.world.set(sgx, platY, T_HARD); 
        this.world.set(sgx+1, platY, T_HARD);
    }

    selectTool(id) {
        if (id === &#039;PAUSE&#039;) this.isPaused = !this.isPaused;
        else if (id === &#039;NUKE&#039;) this.entities.forEach(e =&gt; { if (e instanceof DataPacket) e.pendingPurge = true; });
        else this.selectedTool = id;
        this.updateUI();
    }

    spendCycles(amt) {
        this.cycles -= amt;
        this.updateUI(); 
    }

    handleBoardClick(x, y) {
        // 1. Check for entity interaction (Allow this even when PAUSED!)
        const hit = this.entities.slice().reverse().find(e =&gt; e instanceof DataPacket &amp;&amp; this.api.pointInEntity(x, y, e, 6));
        if (hit) {
            if (hit.assignRole(this.selectedTool, this)) {
                this.spawnEffects(hit.x, hit.y, PALETTE.BIT);
            } else {
                // Failed assignment (no cash)
                this.spawnEffects(hit.x, hit.y, PALETTE.FIRE);
            }
            return;
        }
        
        // 2. Check for Spawner Click (Only if NOT paused)
        if (!this.isPaused) {
            const sX = this.spawnPos.x; const sY = this.spawnPos.y;
            if (x &gt;= sX-15 &amp;&amp; x &lt;= sX+15 &amp;&amp; y &gt;= sY-15 &amp;&amp; y &lt;= sY+15 &amp;&amp; this.packetQueue &gt; 0) {
                this.add(new DataPacket(sX, sY)); 
                this.packetQueue--;
                this.spawnEffects(sX, sY, PALETTE.CODE);
            }
        }
    }

    securePacket() { 
        this.score += 1000; 
        this.cycles += 50; 
        this.api.setScore(this.score); 
        this.updateUI();
    }
    secureBonus() { 
        this.score += 500; 
        this.cycles += 100; 
        this.api.setScore(this.score); 
        this.spawnEffects(this.spawnPos.x, this.spawnPos.y, PALETTE.GOLD); 
        this.updateUI();
    }
    spawnEffects(x, y, color) { for(let i=0; i&lt;5; i++) this.add(new GlitchFragment(x, y, color)); }

    update(dt, input) {
        const effectiveDt = this.isPaused ? 0 : dt;
        
        // Allow clicking even when paused
        if (input.mouse.clicked &amp;&amp; input.mouse.y &lt; this.api.H - UI_HEIGHT) {
            this.handleBoardClick(input.mouse.x, input.mouse.y);
        }

        super.update(effectiveDt, input);
        this.glitchTimer += dt;
        
        const activeCount = this.entities.filter(e =&gt; e instanceof DataPacket).length;
        this.api.setLabel(`CPU: ${this.cycles}¢ | QUEUE: ${this.packetQueue} | ACTIVE: ${activeCount}`);
        
        if (this.packetQueue === 0 &amp;&amp; activeCount === 0) {
            if (this.score &gt; 0) { 
                this.api.saveData(&#039;level&#039;, this.level + 1); 
                // Carry over excess cycles (capped)
                const carry = Math.min(50, Math.floor(this.cycles / 10));
                this.api.saveData(&#039;bonus_carry&#039;, carry);
                this.api.newStage(`CLEARED`, `Score: ${this.score}\nCycles Left: ${this.cycles}`, &quot;NEXT SECTOR&quot;, () =&gt; this.onInit()); 
            } else { this.api.gameOver(&quot;SYSTEM FAILURE&quot;); }
        }
    }

    buildUI() {
        const tools = [
            {id:&#039;WALKER&#039;,lbl:&#039;PING&#039;,col:PALETTE.CODE}, {id:&#039;BASHER&#039;,lbl:&#039;HACK&#039;,col:&#039;#f0f&#039;},
            {id:&#039;MINER&#039;,lbl:&#039;MINE&#039;,col:&#039;#0f0&#039;},        {id:&#039;BUILDER&#039;,lbl:&#039;LINK&#039;,col:PALETTE.HARD},
            {id:&#039;FLOATER&#039;,lbl:&#039;FLOAT&#039;,col:PALETTE.BIT},{id:&#039;BLOCKER&#039;,lbl:&#039;HALT&#039;,col:PALETTE.FIRE},
            {id:&#039;BOMBER&#039;,lbl:&#039;PURGE&#039;,col:&#039;#f00&#039;},      {id:&#039;NUKE&#039;,lbl:&#039;RESET&#039;,col:&#039;#555&#039;},
            {id:&#039;PAUSE&#039;,lbl:&#039;STOP&#039;,col:PALETTE.BIT}
        ];
        
        this.api.UI.build([
            {type:&#039;spacer&#039;,size:this.api.H-UI_HEIGHT+2},
            {type:&#039;grid&#039;,cols:9,gap:0,children:tools.map((t,idx)=&gt;({
                type:&#039;button&#039;,
                id:`btn-${t.id}`,
                text:`${t.lbl}\n[${idx+1}]\n${COSTS[t.id]}¢`,
                style:{
                    fontSize:&#039;8px&#039;, fontWeight:&#039;bold&#039;, paddingTop:&#039;10px&#039;, height:&#039;42px&#039;,
                    backgroundColor:PALETTE.UI_OFF, color:PALETTE.UI_TXT,
                    border:&#039;1px solid #334155&#039;, whiteSpace:&#039;pre&#039;, textAlign:&#039;center&#039;,
                    cursor:&#039;pointer&#039;, margin:&#039;0px&#039;, paddingLeft:&#039;0px&#039;, paddingRight:&#039;0px&#039;,
                    transition:&#039;all 0.2s ease&#039;, backgroundImage:SystemRestoreGame.getIconUrl(t.id,t.col),
                    backgroundRepeat:&#039;no-repeat&#039;, backgroundPosition:&#039;center 3px&#039;, backgroundSize:&#039;10px 10px&#039;
                },
                onClick:()=&gt;this.selectTool(t.id)
            }))}
        ]);
        this.updateUI();
    }

    updateUI() {
        const toolMap = {
            &#039;WALKER&#039;: PALETTE.CODE, &#039;BASHER&#039;: &#039;#f0f&#039;, &#039;MINER&#039;: &#039;#0f0&#039;,
            &#039;BUILDER&#039;: PALETTE.HARD, &#039;FLOATER&#039;: PALETTE.BIT, &#039;BLOCKER&#039;: PALETTE.FIRE,
            &#039;BOMBER&#039;: &#039;#f00&#039;, &#039;NUKE&#039;: &#039;#555&#039;, &#039;PAUSE&#039;: PALETTE.BIT
        };

        [&#039;WALKER&#039;,&#039;BASHER&#039;,&#039;MINER&#039;,&#039;BUILDER&#039;,&#039;FLOATER&#039;,&#039;BLOCKER&#039;,&#039;BOMBER&#039;,&#039;NUKE&#039;,&#039;PAUSE&#039;].forEach(id=&gt;{
            const btn=this.api.UI.get(`btn-${id}`); if(!btn) return;
            const active=(this.selectedTool===id)||(id===&#039;PAUSE&#039;&amp;&amp;this.isPaused);
            const canAfford = this.cycles &gt;= COSTS[id];
            
            // Base state
            if (active) {
                btn.style.backgroundColor = toolMap[id]; 
                btn.style.color = &#039;#000&#039;;
                btn.style.borderTop = `3px solid ${PALETTE.GOLD}`;
                btn.style.filter = &#039;brightness(1.2)&#039;;
            } else if (!canAfford &amp;&amp; id !== &#039;NUKE&#039; &amp;&amp; id !== &#039;PAUSE&#039;) {
                // Disabled state
                btn.style.backgroundColor = PALETTE.UI_DIS;
                btn.style.color = &#039;#334155&#039;; // Dark grey text
                btn.style.borderTop = &#039;1px solid #1e293b&#039;;
                btn.style.filter = &#039;grayscale(1)&#039;;
            } else {
                // Inactive state
                btn.style.backgroundColor = PALETTE.UI_OFF;
                btn.style.color = PALETTE.UI_TXT;
                btn.style.borderTop = &#039;1px solid #475569&#039;;
                btn.style.filter = &#039;none&#039;;
            }
        });
    }

    draw(gfx) {
        gfx.clear(PALETTE.BG);
        for(let x=0; x&lt;this.world.cols; x+=2) {
            if (Math.sin(this.glitchTimer + x*0.2) &gt; 0.97) {
                for(let y=0; y&lt;this.world.rows; y+=2) {
                    if (this.world.get(x,y) === T_NULL) {
                        gfx.text(Math.random()&gt;.5?&#039;1&#039;:&#039;0&#039;, x*GRID_SIZE+2, y*GRID_SIZE+6, {size:6, color:&#039;rgba(0, 229, 255, 0.05)&#039;});
                    }
                }
            }
        }

        for (let y = 0; y &lt; this.world.rows; y++) {
            for (let x = 0; x &lt; this.world.cols; x++) {
                const t = this.world.get(x, y); const px = x * GRID_SIZE; const py = y * GRID_SIZE;
                if (t === T_DATA) { 
                    gfx.rect(px, py, GRID_SIZE, GRID_SIZE, PALETTE.DATA); 
                    if ((x+y)%2===0) gfx.text(Math.random()&gt;.5?&#039;1&#039;:&#039;0&#039;, px+1, py+6, {size:6, color: &#039;rgba(255,255,255,0.08)&#039;});
                }
                else if (t === T_HARD) gfx.rect(px, py, GRID_SIZE, GRID_SIZE, PALETTE.HARD);
                else if (t === T_CODE) gfx.rect(px, py, GRID_SIZE, GRID_SIZE, PALETTE.CODE);
                else if (t === T_CACHE) { gfx.circle(px+4, py+4, 3, PALETTE.GOLD); gfx.text(&#039;$&#039;, px+2, py+6, {size:6, color:PALETTE.BG}); }
                else if (t === T_FIRE) { 
                    const c = (Math.sin(this.glitchTimer*15 + x) &gt; 0) ? PALETTE.FIRE : &#039;#b03c00&#039;;
                    gfx.rect(px, py, GRID_SIZE, GRID_SIZE, c); 
                }
            }
        }
        gfx.rect(this.spawnPos.x-10, this.spawnPos.y-10, 20, 20, PALETTE.HARD);
        gfx.text(&quot;IN&quot;, this.spawnPos.x, this.spawnPos.y+5, {size:10, color:PALETTE.BG, align:&#039;center&#039;, bold:true});
        gfx.rect(0, this.api.H-UI_HEIGHT, this.api.W, UI_HEIGHT, PALETTE.BG);
        gfx.line(0, this.api.H-UI_HEIGHT, this.api.W, this.api.H-UI_HEIGHT, PALETTE.CODE, 1);
        super.draw(gfx);
    }
}

Interactive.register(SystemRestoreGame);</code></pre>
                      <p class="download-btn-container">
                        <a href="/Stealware/PodCube%20API/trash/systemrestore.js" class="page-download-btn" download>DOWNLOAD "systemrestore.js" ⤓</a>
                      </p>
                    </div>
  
  


                    
                    
                    
                    <div id="dir-sentinel" style="display: block; width: 100%; visibility: hidden; pointer-events: none;"></div>
                </main>
            
            
                
                
                
                
                
                    <section class="directory-container">
                        <div class="directory-header">
                            
                                <a href="/Stealware/PodCube API/" class="nav-link-small up">...</a><span class="nav-link-small up" style="color: var(--border-color)">\</span>
                            
                            
                            
                            <h3 class="directory-title">
                                trash
                            </h3>
                        </div>
                        
                        
                            <ul class="dir-listing">

                                


                                
                                
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/PodCube API/trash/datastream.js.html">datastream.js</a>
                                        <a href="/Stealware/PodCube API/trash/datastream.js" download class="dir-download-icon" title="Download datastream.js"></a>
                                    </li>
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/PodCube API/trash/interactive_gem.js.html">interactive_gem.js</a>
                                        <a href="/Stealware/PodCube API/trash/interactive_gem.js" download class="dir-download-icon" title="Download interactive_gem.js"></a>
                                    </li>
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/PodCube API/trash/interactive_old.js.html">interactive_old.js</a>
                                        <a href="/Stealware/PodCube API/trash/interactive_old.js" download class="dir-download-icon" title="Download interactive_old.js"></a>
                                    </li>
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/PodCube API/trash/lemmings.js.html">lemmings.js</a>
                                        <a href="/Stealware/PodCube API/trash/lemmings.js" download class="dir-download-icon" title="Download lemmings.js"></a>
                                    </li>
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/PodCube API/trash/old_snake.js.html">old_snake.js</a>
                                        <a href="/Stealware/PodCube API/trash/old_snake.js" download class="dir-download-icon" title="Download old_snake.js"></a>
                                    </li>
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/PodCube API/trash/quiz_old.js.html">quiz_old.js</a>
                                        <a href="/Stealware/PodCube API/trash/quiz_old.js" download class="dir-download-icon" title="Download quiz_old.js"></a>
                                    </li>
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/PodCube API/trash/snake_old.js.html">snake_old.js</a>
                                        <a href="/Stealware/PodCube API/trash/snake_old.js" download class="dir-download-icon" title="Download snake_old.js"></a>
                                    </li>
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/PodCube API/trash/systemrestore.js.html">systemrestore.js</a>
                                        <a href="/Stealware/PodCube API/trash/systemrestore.js" download class="dir-download-icon" title="Download systemrestore.js"></a>
                                    </li>
                                
                            </ul>
                        
                    </section>
                
            
            
        <script src="/js/main.js"></script>
    </body>
</body></html>