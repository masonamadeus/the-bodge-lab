<!DOCTYPE html>
<html lang="en">
    <head>
        
        <script>
            (function () {
                const STORAGE_KEY = 'bodge-id-v1';
                const SIZE = 5;
                // 1. Try to load existing identity
                let identity = null;
                try {
                    identity = JSON.parse(localStorage.getItem(STORAGE_KEY));
                } catch (e) {}
                // 2. If no identity, GENESIS MODE (Random Generation)
                if (! identity) {
                    const hue = Math.floor(Math.random() * 360);
                    const grid = new Array(SIZE * SIZE).fill(null);
                    // Generate Mirrored Pattern
                    for (let x = 0; x < Math.ceil(SIZE / 2); x++) {
                        for (let y = 0; y < SIZE; y++) {
                            if (Math.random() > 0.5) {
                                const alpha = (Math.random() * 0.6 + 0.4).toFixed(2);
                                // We store: { o: opacity, c: customColor (optional) }
                                const pixel = {
                                    o: alpha
                                };
                                // Set Left
                                grid[y * SIZE + x] = pixel;
                                // Set Mirror
                                if (x < Math.floor(SIZE / 2)) {
                                    grid[y * SIZE + (SIZE - 1 - x)] = pixel;
                                }
                            }
                        }
                    }
                    identity = {
                        hue,
                        grid
                    };
                    localStorage.setItem(STORAGE_KEY, JSON.stringify(identity));
                }
                // 3. Render SVG Define Theme Colors based on the stored Hue
                const cLight = `hsl(${
                    identity.hue
                }, 80%, 40%)`;
                const cDark = `hsl(${
                    identity.hue
                }, 80%, 70%)`;
                let rects = '';
                identity.grid.forEach((pixel, i) => {
                    if (!pixel) 
                        return;
                    
                    const x = i % SIZE;
                    const y = Math.floor(i / SIZE);
                    // If pixel has a custom color, use it. Otherwise use CSS var. We use a CSS class 'themable' to let the style block
                    // handle standard pixels
                    const fillAttr = pixel.c
                        ? `fill="${
                        pixel.c
                    }"` : `class="themable"`;
                    rects += `<rect x="${x}" y="${y}" width="1" height="1" opacity="${
                        pixel.o
                    }" ${fillAttr} />`;
                });
                const svg = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${SIZE} ${SIZE}" shape-rendering="crispEdges">
            <style>
                .themable { fill: ${cLight}; }
                @media (prefers-color-scheme: dark) {
                    .themable { fill: ${cDark}; } 
                }
                /* Custom text color checks */
                text { fill: black; font-weight: 900; pointer-events: none; }
                @media (prefers-color-scheme: dark) { text { fill: white; } }
            </style>
            ${rects}
            <text x="2.5" y="3.5" text-anchor="middle" font-family="monospace" font-size="3px"></text>
            </svg>`;
                const link = document.createElement('link');
                link.rel = 'icon';
                link.id = 'dynamic-favicon'; // ID for easier updates later
                link.href = 'data:image/svg+xml,' + encodeURIComponent(svg);
                document.head.appendChild(link);
                // Expose for the editor to use
                window.BodgeIdentity = {
                    data: identity,
                    save: (newData) => {
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(newData));
                    }
                };
            })();
        </script>
        <link rel="stylesheet" href="/css/main.css">
        <script src="/js/theme.js"></script>
        <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <meta charset="UTF-8">
        <title>MW_Coffee Cup (Automatic VX Prep).lua</title>
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="generator" content="Eleventy v3.1.2">
        <meta name="description" content="A curious folder on the internet. Home of Mason Amadeus">
        <link
        rel="canonical" href="https://bodgelab.com/%7B%7B%20media.url%20|%20safe%20%7D%7D.html"> 
        <meta property="og:site_name" content="The Bodge Lab">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://bodgelab.com/%7B%7B%20media.url%20|%20safe%20%7D%7D.html">
        <meta property="og:title" content="MW_Coffee Cup (Automatic VX Prep).lua">
        <meta
        property="og:description" content="A curious folder on the internet. Home of Mason Amadeus"> 
        <meta property="og:image" content="https://bodgelab.com/.config/ogimg.jpg">
        <meta
        name="twitter:image" content="https://bodgelab.com/.config/ogimg.jpg">
        
        
            
            <meta name="twitter:card" content="summary_large_image">
        
    </head>
    <body>
        <svg id="paperfilter">
            <defs>
                <filter id="paperlike" x="-20%" y="-20%" width="140%" height="140%" type="fractalNoise">
                    <feTurbulence basefrequency="0.0005" numoctaves="1" result="noise"/>
                    <feDisplacementMap in="SourceGraphic" in2="noise" scale="1" xchannelselector="R" ychannelselector="R"></filter>
                </defs>
            </svg>
            <header class="sticky">
                <nav class="nav-container">
                    <div class="breadcrumb-nav">
                        <div class="breadcrumb-mover">
                            <button id="theme-toggle" class="theme-toggle" aria-label="Toggle Theme">
                                <svg
                                    viewbox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    class="theme-icon">
                                    <path id="sun-icon" d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                                    <g id="moon-icon">
                                        <path d="M12 2a7 7 0 0 0-7 7c0 2.32 1.04 4.39 2.66 5.82a2 2 0 0 1 .68 1.48V19a2 2 0 0 0 2 2h3.32a2 2 0 0 0 2-2v-2.7a2 2 0 0 1
                                            .68-1.48C17.96 13.39 19 11.32 19 9a7 7 0 0 0-7-7Z"></path>
                                        <path d="M9 21h6"></path>
                                        <path d="M9 17h6"></path>
                                    </g>
                                </svg>
                            </button>
                            <span class="separator">\\</span>
                            <a href="/" class="breadcrumb" title="Home Directory">BodgeLab</a>
                            
                            
                            
                                
                            
                                
                                    
                                    <span class="separator">\</span>
                                    
                                        <a href="/Stealware/" class="breadcrumb">Stealware</a>
                                    
                                
                            
                                
                                    
                                    <span class="separator">\</span>
                                    
                                        <a href="/Stealware/REAPER Add-Ons/" class="breadcrumb">REAPER Add-Ons</a>
                                    
                                
                            
                                
                                    
                                    <span class="separator">\</span>
                                    
                                        <span class="current">MW_Coffee Cup (Automatic VX Prep).lua</span>
                                    
                                
                            
                        </div>
                    </div>
                    <div
                        class="page-nav">
                        
                        
                            <div>
                                <a href="/Stealware/REAPER Add-Ons/" class="nav-link up">⇱ Go Up</a>
                            </div>
                        
                        
                        
                            <div class="page-meta-date">
                                <i>
                                    <em>Modified: February 28, 2026</em>
                                </i>
                            </div>
                        
                    </div>
                </nav>
            </header>
            
                <main class="main-content">
                    
  <h2>MW_Coffee Cup (Automatic VX Prep).lua</h2>
  
  
  
    <div class="media-embed-wrapper text-embed">
                      <pre class="language-lua"><code class="language-lua">--[[ Prompt user to enter values for tooLoud and shortLen variables
local retval, input = reaper.GetUserInputs(&quot;Set variables&quot;, 2, &quot;Overloud Threshold (dB),Short Length (seconds)&quot;, &quot;20,2&quot;)
if not retval then return end -- exit script if user cancels dialog
local tooLoud, shortLen = input:match(&quot;([^,]+),([^,]+)&quot;)
tooLoud = tonumber(tooLoud)
shortLen = tonumber(shortLen)
--]]


--- Set variables
tooLoud = 25 -- set maximum allowed volume increase (in dB)
shortLen = 2 
fadeLen = 0.15
overLoud = {} -- array to hold overloud media items

-- Define add_fade_in function to add fade-in to beginning of every item 
function add_fade_in()
    for i = 0, new_selected_items - 1 do 
      local item = reaper.GetSelectedMediaItem(0,i) 
      reaper.SetMediaItemInfo_Value(item,&quot;D_FADEINLEN&quot;,fadeLen) 
      reaper.SetMediaItemInfo_Value(item,&quot;D_FADEOUTLEN&quot;,fadeLen) 
    end
end

-- Define &quot;find nearest media item&quot; function
function findNearestMediaItem(track, currentItem)
    --reaper.ShowConsoleMsg(&quot;Called FindNearest&quot;)

    local nearestItem = nil
    local nearestTimeDiff = math.huge

    for i = 1, reaper.CountTrackMediaItems(track) do
        local item = reaper.GetTrackMediaItem(track, i-1)
        if item ~= currentItem then
            local itemStart = reaper.GetMediaItemInfo_Value(item, &quot;D_POSITION&quot;)
            local itemEnd = itemStart + reaper.GetMediaItemInfo_Value(item, &quot;D_LENGTH&quot;)
            local currentItemStart = reaper.GetMediaItemInfo_Value(currentItem, &quot;D_POSITION&quot;)
            local currentItemEnd = currentItemStart + reaper.GetMediaItemInfo_Value(currentItem, &quot;D_LENGTH&quot;)
            local timeDiff = math.abs(itemStart - currentItemStart)
            if timeDiff &lt; nearestTimeDiff then
                nearestTimeDiff = timeDiff
                nearestItem = item
            end
            timeDiff = math.abs(itemEnd - currentItemEnd)
            if timeDiff &lt; nearestTimeDiff then
                nearestTimeDiff = timeDiff
                nearestItem = item
            end
        end
    end

    return nearestItem
end

-- Function to check if a media item will clip when played
function checkMediaItemForClipping(item)
  local take = reaper.GetActiveTake(item)
  local peak = reaper.NF_GetMediaItemMaxPeak(item)
  local maxLevel = 0 -- maximum level before clipping
  local takeVol = reaper.GetMediaItemTakeInfo_Value(take, &quot;D_VOL&quot;)
  local takeVolDB = 20 * math.log(takeVol,10) -- convert take volume to dB

  -- Determine if the item will clip
  if takeVolDB + peak &gt; 0 then
    -- Calculate the amount of gain reduction required to avoid clipping
    local reductionDB = maxLevel - peak + 0.1
    local reductionLin = 10 ^ (reductionDB / 20) -- convert dB to linear

    -- Reduce the take volume by the calculated amount
    reaper.SetMediaItemTakeInfo_Value(take, &quot;D_VOL&quot;, reductionLin)

    return true
  else
    return false
  end
end

function ResetRipple()
  if rippleAll then reaper.Main_OnCommand(40311,0) end
  if ripplePer then reaper.Main_OnCommand(40311,0) end
end

--[[ ===============================================
============== SCRIPT MAIN BODY START ==============
================================================]]--


-- this ripple shit isn&#039;t working
local rippleAll = false
local ripplePer = false

local rippleAllState = reaper.GetToggleCommandState(40311) -- all tracks
local ripplePerState = reaper.GetToggleCommandState(40310) -- per track

if rippleAllState == 1 then local rippleAll = true end
if ripplePerState == 1 then local ripplePer = true end

-- Stop transport and turn ripple edit off
reaper.Main_OnCommand(1016, 0) -- Transport: Stop
reaper.Main_OnCommand(40309, 0) -- Options: Ripple editing off
reaper.Main_OnCommand(41923, 0) -- Item: Reset items volume to +0dB

-- Count selected media items
selected_items = reaper.CountSelectedMediaItems(0)
if selected_items == 0 then return end

--[[
videoSources = {}

-- unselect any video items
for i=0, selected_items-1 do
  local itemV = reaper.GetSelectedMediaItem(0,i)
  local sourceV = reaper.GetMediaItemTake_Source(reaper.GetMediaItemTake(itemV,0))
  local sourceType = reaper.GetMediaSourceType(sourceV)
  if sourceType == &quot;VIDEO&quot; then 
    table.insert(videoSources,itemV)
  end
end

for _,video in ipairs(videoSources) do
  reaper.SetMediaItemSelected(video,false)
end

reaper.UpdateArrange()
selected_items = reaper.CountSelectedMediaItems(0)
--]]


reaper.Undo_BeginBlock()
-- Normalize selected media items to 0 LUFS using SWS/BR action
reaper.Main_OnCommand(reaper.NamedCommandLookup(&quot;_BR_NORMALIZE_LOUDNESS_ITEMS_LU&quot;), 0)

reaper.Undo_EndBlock(&quot;Normalize&quot;,0)
-- Launch Dynamic Split feature
reaper.Main_OnCommand(40760, 0)
-- Wait for number of selected media items to change
function wait_for_change()
    new_selected_items = reaper.CountSelectedMediaItems(0)
    if new_selected_items == 0 then ResetRipple() return end
    if new_selected_items &lt; selected_items then ResetRipple() return end
    if new_selected_items &gt; selected_items then
        reaper.Undo_BeginBlock()
        -- Normalize new media items to -23 LUFS if number of selected media items increases
        reaper.Main_OnCommand(reaper.NamedCommandLookup(&quot;_BR_NORMALIZE_LOUDNESS_ITEMS23&quot;), 0)

        -- Check for overloud media items and add to overLoud array
        for i = 0, new_selected_items - 1 do
            local itemL = reaper.GetSelectedMediaItem(0, i)
            local takeL = reaper.GetActiveTake(itemL)
            local vol = reaper.GetMediaItemTakeInfo_Value(takeL, &quot;D_VOL&quot;)
            if 20 * math.log(vol, 10) &gt; tooLoud then
                table.insert(overLoud, itemL)
            end
        end
        
        -- Delete overloud media items in overLoud array
        for _, itemO in ipairs(overLoud) do
             groupId = reaper.GetMediaItemInfo_Value(itemO,&quot;I_GROUPID&quot;)
            if groupId ~= 0 then
              numItems = reaper.CountMediaItems(0)
              for ill=0, numItems-1 do
                checkItem = reaper.GetMediaItem(-1,ill)
                if checkItem ~= nil then
                  if reaper.GetMediaItemInfo_Value(checkItem,&quot;I_GROUPID&quot;) == groupId then
                    reaper.DeleteTrackMediaItem(reaper.GetMediaItem_Track(checkItem),checkItem)
                  end
                end
              end
            end
            reaper.DeleteTrackMediaItem(reaper.GetMediaItem_Track(itemO),itemO)
           
        end--]]
        
        new_selected_items = reaper.CountSelectedMediaItems(0)

        -- Set take volume of short media items to same as next nearest item on same track
        for i = 0, new_selected_items - 1 do
            local itemS = reaper.GetSelectedMediaItem(0, i)
            local item_len = reaper.GetMediaItemInfo_Value(itemS, &quot;D_LENGTH&quot;)
            
            if item_len &lt; shortLen then
                local trackS = reaper.GetMediaItem_Track(itemS)
                local next_item = findNearestMediaItem(trackS,itemS)
                if next_item ~= nil then
                    local takeS = reaper.GetActiveTake(itemS)
                    local next_take = reaper.GetActiveTake(next_item)
                    local next_vol = reaper.GetMediaItemTakeInfo_Value(next_take, &quot;D_VOL&quot;)
                    local current_vol = reaper.GetMediaItemTakeInfo_Value(takeS, &quot;D_VOL&quot;)
                    local volDiff =(current_vol - next_vol)*0.5
                    
                    --reaper.ShowConsoleMsg(&quot;next vol &quot; .. next_vol .. &quot;\nCurrent Vol &quot; .. current_vol .. &quot;\nVolDiff &quot; .. volDiff)
                    
                    if current_vol &gt; next_vol then
                      reaper.SetMediaItemTakeInfo_Value(takeS, &quot;D_VOL&quot;, current_vol + volDiff)
                    end
                      
                end
            end
            
           -- checkMediaItemForClipping(item)
            
            
        end

        -- Add fade-in to beginning of every item using custom function (see previous message for function definition)
        add_fade_in()

        -- Crossfade any overlapping items using SWS action
        reaper.Main_OnCommand(41059, 0)
        

        reaper.UpdateArrange()
        
        reaper.Undo_EndBlock(&quot;Coffee Cup&quot;,0)
        
    else
        -- Continue waiting if number of selected media items does not change
        reaper.defer(wait_for_change)
    end
end

-- Call wait_for_change function after launching Dynamic Split feature
reaper.defer(wait_for_change)</code></pre>
                      <p class="download-btn-container">
                        <a href="/Stealware/REAPER%20Add-Ons/MW_Coffee%20Cup%20(Automatic%20VX%20Prep).lua" class="page-download-btn" download>DOWNLOAD "MW_Coffee Cup (Automatic VX Prep).lua" ⤓</a>
                      </p>
                    </div>
  
  


                    
                    
                    
                    <div id="dir-sentinel" style="display: block; width: 100%; visibility: hidden; pointer-events: none;"></div>
                </main>
            
            
                
                
                
                
                
                    <section class="directory-container">
                        <div class="directory-header">
                            
                                <a href="/Stealware/" class="nav-link-small up">...</a><span class="nav-link-small up" style="color: var(--border-color)">\</span>
                            
                            
                            
                            <h3 class="directory-title">
                                Actions Catalog
                            </h3>
                        </div>
                        
                        
                            <ul class="dir-listing">

                                
                                    <li class="directory-index-in-list">
                                        <span class="icon" style="-webkit-mask-image: url('/.config/pageicon.svg'); mask-image: url('/.config/homeicon.svg');"></span>
                                        
                                            <a href="/Stealware/REAPER Add-Ons/">Actions Catalog</a>
                                        
                                    </li>
                                


                                
                                    <li>
                                        <span
                                            class="icon"
                                            style="-webkit-mask-image: url('/.config/foldericon.svg'); mask-image: url('/.config/foldericon.svg');"></span>
                                        <a href="/Stealware/REAPER Add-Ons/images/">images\</a>
                                    </li>
                                
                                    <li>
                                        <span
                                            class="icon"
                                            style="-webkit-mask-image: url('/.config/foldericon.svg'); mask-image: url('/.config/foldericon.svg');"></span>
                                        <a href="/Stealware/REAPER Add-Ons/Video Processor Presets/">Video Processor Presets\</a>
                                    </li>
                                
                                
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/REAPER Add-Ons/MW_Breakout Audio Tracks from Video.lua.html">MW_Breakout Audio Tracks from Video.lua</a>
                                        <a href="/Stealware/REAPER Add-Ons/MW_Breakout Audio Tracks from Video.lua" download class="dir-download-icon" title="Download MW_Breakout Audio Tracks from Video.lua"></a>
                                    </li>
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/REAPER Add-Ons/MW_Coffee Cup (Automatic VX Prep).lua.html">MW_Coffee Cup (Automatic VX Prep).lua</a>
                                        <a href="/Stealware/REAPER Add-Ons/MW_Coffee Cup (Automatic VX Prep).lua" download class="dir-download-icon" title="Download MW_Coffee Cup (Automatic VX Prep).lua"></a>
                                    </li>
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/REAPER Add-Ons/MW_Duck Breath.lua.html">MW_Duck Breath.lua</a>
                                        <a href="/Stealware/REAPER Add-Ons/MW_Duck Breath.lua" download class="dir-download-icon" title="Download MW_Duck Breath.lua"></a>
                                    </li>
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/REAPER Add-Ons/MW_Easy TTS (Amazon Polly CLI REQUIRED).lua.html">MW_Easy TTS (Amazon Polly CLI REQUIRED).lua</a>
                                        <a href="/Stealware/REAPER Add-Ons/MW_Easy TTS (Amazon Polly CLI REQUIRED).lua" download class="dir-download-icon" title="Download MW_Easy TTS (Amazon Polly CLI REQUIRED).lua"></a>
                                    </li>
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/REAPER Add-Ons/MW_Halve Gaps Between Items (Zeno&#39;s Scruncher).lua.html">MW_Halve Gaps Between Items (Zeno&#39;s Scruncher).lua</a>
                                        <a href="/Stealware/REAPER Add-Ons/MW_Halve Gaps Between Items (Zeno&#39;s Scruncher).lua" download class="dir-download-icon" title="Download MW_Halve Gaps Between Items (Zeno&#39;s Scruncher).lua"></a>
                                    </li>
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/REAPER Add-Ons/MW_Hide Non-Selected Tracks (togglable).lua.html">MW_Hide Non-Selected Tracks (togglable).lua</a>
                                        <a href="/Stealware/REAPER Add-Ons/MW_Hide Non-Selected Tracks (togglable).lua" download class="dir-download-icon" title="Download MW_Hide Non-Selected Tracks (togglable).lua"></a>
                                    </li>
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/REAPER Add-Ons/MW_Place Keeper.lua.html">MW_Place Keeper.lua</a>
                                        <a href="/Stealware/REAPER Add-Ons/MW_Place Keeper.lua" download class="dir-download-icon" title="Download MW_Place Keeper.lua"></a>
                                    </li>
                                
                                    <li>
                                        <span class="icon" style="-webkit-mask-image: url('/.config/fileicon.svg'); mask-image: url('/.config/fileicon.svg');"></span>
                                        <a class="nowrap" href="/Stealware/REAPER Add-Ons/MW_Toggle Faster Playback.lua.html">MW_Toggle Faster Playback.lua</a>
                                        <a href="/Stealware/REAPER Add-Ons/MW_Toggle Faster Playback.lua" download class="dir-download-icon" title="Download MW_Toggle Faster Playback.lua"></a>
                                    </li>
                                
                            </ul>
                        
                    </section>
                
            
            
        <script src="/js/main.js"></script>
    </body>
</body></html>