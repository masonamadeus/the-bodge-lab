---
permalink: 404.html
layout: layout.njk
title: "Page Not Found (404)"
eleventyExcludeFromCollections: true
directory: false
download: false
---

<h1>Oops! Page Not Found (404)</h1>
<p>I couldn't find the page you were looking for. </p>
    
    <p>This is The <em>Bodge</em> Lab, so things get moved around!</p>

 <h3>Based on the URL you tried, were you looking for one of these?</h3>

<div id="smart-search-results">
    <p><i>Searching for matches...</i></p>
</div>
<div>
    <p>Keywords: "<i id="search-keywords"></i>"</p>
</div>
<hr>
<p>Or, you can try heading back to the <a href="/">homepage</a>.</p>


<script>
  // 1. Listen for the 'bodgelab:searchready' event
  document.addEventListener('bodgelab:searchready', async () => {

   /**
   * decodes HTML and shit
   */
  function decodeSearchString(str) {
    if (!str) return '';
    
    // 1. Decode URL encoding (%20 -> space, %26 -> &, etc.)
    // We use try/catch in case the string is partially malformed.
    try {
      str = decodeURIComponent(str);
    } catch (e) {
      // If it fails, proceed with the original string, letting the HTML decoder handle what it can.
    }
    
    // 2. Decode ALL HTML entities using a temporary DOM element.
    // This is the most reliable way to handle &amp;, &quot;, etc.
    const textarea = document.createElement('textarea');
    textarea.innerHTML = str;
    str = textarea.value;

    return str;
  }
    
    // 2. Get the data and elements
    const resultsContainer = document.getElementById('smart-search-results');
    const keywordsContainer = document.getElementById('search-keywords')
    
    // 3. Fetch the search data (or get from cache)
    resultsContainer.innerHTML = '<p><i>Loading search data...</i></p>';
    const allPages = await window.BodgeLab.getSearchData();
 
    // 4. Get the query from the bad URL
    const badPath = window.location.pathname.toLowerCase();
    const keywords = decodeSearchString(badPath)
    .replace(/[\/\-]/g, ' ')          // Treat slashes and hyphens as spaces
    .replace(/[^a-z0-9\s]/g, ' ')   // Remove all other punctuation (which is now just spaces)
    .split(/\s+/)                  
    .filter(k => k.length > 0 && k !== 'index');

    keywordsContainer.innerHTML = keywords;
    
    // 5. Run the search
    const results = window.BodgeLab.runSearch(badPath, allPages);

    // 6. Check for single result and redirect
    if (results.length === 1) {
      const redirectUrl = results[0].url;
      resultsContainer.innerHTML = `<p><i>One match found! Redirecting you to: <a href="${redirectUrl}">${redirectUrl}</a>...</i></p>`;
      window.location.href = redirectUrl;
    } else {
      // 7. Render list
      window.BodgeLab.renderResults(results, resultsContainer, keywords);
    }
  });
</script>