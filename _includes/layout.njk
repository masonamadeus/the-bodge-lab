<!DOCTYPE html>
<html lang="en">
    <head>
        <script src="/js/theme.js"></script>
        <meta charset="UTF-8">
        <title>BodgeLab: {{ title }}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="/css/main.css">
    </head>
    <body>
        <header>
            <nav class="nav-container">
                <div class="breadcrumb-nav">
                    <span class="separator">\\</span>
                    <a href="/" class="breadcrumb" title="Home Directory">BodgeLab</a>
                    {% set url_parts = page.url | split('/') %}
                    {% set accumulated_path = '' %}
                    {% for part in url_parts %}
                        {% if part and part != 'index.html' %}
                            {% set accumulated_path = accumulated_path + '/' + part %}
                            <span class="separator">\</span>
                            {% if not loop.last %}
                                <a href="{{ accumulated_path }}/" class="breadcrumb">{{ part }}</a>
                            {% else %}
                                <span class="current">{{ title if title and title != "Home" else part }}</span>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </div>
                <div
                    class="page-nav">
                    {# Left Side: Parent Link #}
                    {% if page.url != "/" %}
                    <div>
                        
                            {# 1. Get the current URL #}
                            {% set my_url = page.url %}
                            {# 2. Strip trailing slash (unless it's the root) #}
                            {% if my_url.endsWith('/') and my_url.length > 1 %}
                                {% set my_url = my_url.substring(0, my_url.length - 1) %}
                            {% endif %}
                            {# 3. Find the parent directory path #}
                            {% set parent_href = my_url.substring(0, my_url.lastIndexOf('/')) + '/' %}
                            <a href="{{ parent_href }}" class="nav-link up">â†‘ Up One Level</a>
                        
                    </div>
                    {% endif %}
                    {# Right Side: Date #}
                    
                    {% if date and page.url != "/" %}
                    <div class="page-meta-date">
                            <i>
                                <em>Updated: {{ date | readableDate }}</em>
                            </i>
                    </div>
                        {% endif %}
                </div>
            </nav>
        </header>
        {% if content or media %}
            <main class="main-content">
                {% block content %}
                    {{ content | safe }}
                {% endblock %}
                {% if download %}
                    <div class="page-meta">
                        {% set download_href = "" %}
                        {% if media and media.url %}
                            {# This is a media page. Use the media.url (e.g., /Bug & Moss/logo.jpg) #}
                            {% set download_href = media.url %}
                        {% else %}
                            {# This is a post page. Use the page.inputPath (e.g., /posts/firstpost.md) #}
                            {% set download_href = "/" + page.inputPath | replace('content/', '') %}
                        {% endif %}
                        <hr>
                        <p>
                            <a class="page-download-btn" href="{{ download_href | safe }}" download>
                                DOWNLOAD
                            </a>
                        </p>
                    </div>
                {% endif %}
            </main>
            <br>
        {% endif %}
        {# --- DIRECTORY LISTING SECTION --- #}
        {% if directory %}
            {% set hasDirs = directoryContents.directories | length > 0 %}
            {% set hasPages = directoryContents.pages | length > 0 %}
            {% set hasFiles = directoryContents.files | length > 0 %}
            {% set hasContent = hasDirs or hasPages or hasFiles %}
            {% if hasContent %}
                <section class="directory-container">
                    <h3 class="directory-title">{{ directoryTitle | safe }}</h3>
                    {# 2. Directory Contents Listing #}
                    {% if directoryContents %}
                        <ul class="dir-listing">
                            {% for dir in directoryContents.directories %}
                                <li>
                                    <span
                                        class="icon"
                                        style="-webkit-mask-image: url('/site resources/foldericon.svg'); mask-image: url('/site resources/foldericon.svg');"></span>
                                    <a href="{{ dir.url }}">{{ dir.name }}/</a>
                                </li>
                            {% endfor %}
                            {% for page in directoryContents.pages %}
                                <li>
                                    <span
                                        class="icon"
                                        style="-webkit-mask-image: url('/site resources/pageicon.svg'); mask-image: url('/site resources/pageicon.svg');"></span>
                                    <a href="{{ page.url }}">{{ page.name }}</a>
                                </li>
                            {% endfor %}
                            {% for file in directoryContents.files %}
                                <li>
                                    <span
                                        class="icon"
                                        style="-webkit-mask-image: url('/site resources/fileicon.svg'); mask-image: url('/site resources/fileicon.svg');"></span>
                                    <a href="{{ file.url }}">{{ file.name }}</a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </section>
                
        
        <div class = "site-options-row">
        <button id="theme-toggle" class="theme-toggle">Dark Mode</button>
        </div>
            {% endif %}
            
        {% endif %}
        <script src="/js/main.js"></script>
    </body>
</html>